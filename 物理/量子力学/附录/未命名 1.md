
### 第一步：定义球坐标与直角坐标的变换关系

球坐标$(r, \theta, \phi)$与直角坐标$(x, y, z)$的关系为：$$\begin{aligned}x &= r \sin\theta \cos\phi \\y &= r \sin\theta \sin\phi \\z &= r \cos\theta\end{aligned}\tag{1}$$

其中：
-  $r \geq 0$ 
-  $\theta \in [0, \pi]$ （极角，从 z 轴正方向测量）
-  $\phi \in [0, 2\pi)$ （方位角，在 xy 平面内从 x 轴测量）

我们的目标是将$$
\nabla^2 f = \frac{\partial^2 f}{\partial x^2} + \frac{\partial^2 f}{\partial y^2}+\frac{\partial^2 f}{\partial z^2}$$
用 $r, \theta, \phi$ 表示。

---

### 第二步：使用正交曲线坐标系的一般公式（但先推导尺度因子）

在正交曲线坐标系 $(q_1, q_2, q_3)$ 中，若位置矢量为 $\vec{r}(q_1, q_2, q_3)$，则三个**尺度因子**（scale factors）定义为：$$
h_i = \left| \frac{\partial \vec{r}}{\partial q_i} \right|, \quad i = 1,2,3$$

对于球坐标，取：
- $q_1 = r$
- $q_2 = \theta$
- $q_3 = \phi$

位置矢量：$$\vec{r} = x\,\hat{i} + y\,\hat{j} + z\,\hat{k} = r \sin\theta \cos\phi\, \hat{i} + r \sin\theta \sin\phi\, \hat{j} + r \cos\theta\, \hat{k}$$

计算偏导数：
#### 1. 对 r 求偏导：$$
\frac{\partial \vec{r}}{\partial r} = \sin\theta \cos\phi\, \hat{i} + \sin\theta \sin\phi\, \hat{j} + \cos\theta\, \hat{k}$$
其模长：$$
h_r = \left| \frac{\partial \vec{r}}{\partial r} \right| = \sqrt{ (\sin\theta \cos\phi)^2 + (\sin\theta \sin\phi)^2 + (\cos\theta)^2 } = \sqrt{ \sin^2\theta (\cos^2\phi + \sin^2\phi) + \cos^2\theta } = \sqrt{ \sin^2\theta + \cos^2\theta } = 1$$

#### 2. 对 $\theta$ 求偏导：$$
\frac{\partial \vec{r}}{\partial \theta} = r \cos\theta \cos\phi\, \hat{i} + r \cos\theta \sin\phi\, \hat{j} - r \sin\theta\, \hat{k}$$
模长：$$
h_\theta = \left| \frac{\partial \vec{r}}{\partial \theta} \right| = r \sqrt{ \cos^2\theta (\cos^2\phi + \sin^2\phi) + \sin^2\theta } = r \sqrt{ \cos^2\theta + \sin^2\theta } = r$$

#### 3. 对 $\phi$ 求偏导：$$
\frac{\partial \vec{r}}{\partial \phi} = -r \sin\theta \sin\phi\, \hat{i} + r \sin\theta \cos\phi\, \hat{j} + 0\, \hat{k}$$
模长：
\[
h_\phi = \left| \frac{\partial \vec{r}}{\partial \phi} \right| = r \sin\theta \sqrt{ \sin^2\phi + \cos^2\phi } = r \sin\theta
\]

所以，三个尺度因子为：
\[
h_r = 1, \quad h_\theta = r, \quad h_\phi = r \sin\theta
\tag{2}
\]

---

### 第三步：写出正交曲线坐标系中梯度和散度的表达式

在正交曲线坐标系中，**梯度**为：
\[
\nabla f = \frac{1}{h_r} \frac{\partial f}{\partial r} \hat{e}_r + \frac{1}{h_\theta} \frac{\partial f}{\partial \theta} \hat{e}_\theta + \frac{1}{h_\phi} \frac{\partial f}{\partial \phi} \hat{e}_\phi
\]

**散度**（对任意向量场 \vec{A} = A_r \hat{e}_r + A_\theta \hat{e}_\theta + A_\phi \hat{e}_\phi）为：
\[
\nabla \cdot \vec{A} = \frac{1}{h_r h_\theta h_\phi} \left[
\frac{\partial}{\partial r} (h_\theta h_\phi A_r) +
\frac{\partial}{\partial \theta} (h_r h_\phi A_\theta) +
\frac{\partial}{\partial \phi} (h_r h_\theta A_\phi)
\right]
\tag{3}
\]

而**拉普拉斯算符**定义为：
\[
\nabla^2 f = \nabla \cdot (\nabla f)
\]

所以我们先计算 \nabla f，再对其取散度。

---

### 第四步：计算 \nabla f 在球坐标中的分量

由梯度公式和 (2) 得：

\[
\nabla f = \frac{\partial f}{\partial r} \hat{e}_r + \frac{1}{r} \frac{\partial f}{\partial \theta} \hat{e}_\theta + \frac{1}{r \sin\theta} \frac{\partial f}{\partial \phi} \hat{e}_\phi
\]

因此，向量场 \vec{A} = \nabla f 的分量为：

\[
A_r = \frac{\partial f}{\partial r}, \quad
A_\theta = \frac{1}{r} \frac{\partial f}{\partial \theta}, \quad
A_\phi = \frac{1}{r \sin\theta} \frac{\partial f}{\partial \phi}
\tag{4}
\]

---

### 第五步：代入散度公式 (3)

首先计算体积元因子（即 h_r h_\theta h_\phi）：

\[
h_r h_\theta h_\phi = (1)(r)(r \sin\theta) = r^2 \sin\theta
\tag{5}
\]

现在逐项计算散度中的三项：

#### 第一项（对 r 的导数）：
\[
\frac{\partial}{\partial r} (h_\theta h_\phi A_r) = \frac{\partial}{\partial r} \left( r \cdot r \sin\theta \cdot \frac{\partial f}{\partial r} \right) = \frac{\partial}{\partial r} \left( r^2 \sin\theta \frac{\partial f}{\partial r} \right)
\]
由于 \sin\theta 与 r 无关，可提出：
\[
= \sin\theta \frac{\partial}{\partial r} \left( r^2 \frac{\partial f}{\partial r} \right)
\tag{6}
\]

#### 第二项（对 \theta 的导数）：
\[
\frac{\partial}{\partial \theta} (h_r h_\phi A_\theta) = \frac{\partial}{\partial \theta} \left( 1 \cdot r \sin\theta \cdot \frac{1}{r} \frac{\partial f}{\partial \theta} \right) = \frac{\partial}{\partial \theta} \left( \sin\theta \frac{\partial f}{\partial \theta} \right)
\tag{7}
\]

（注意：r 被约掉了）

#### 第三项（对 \phi 的导数）：
\[
\frac{\partial}{\partial \phi} (h_r h_\theta A_\phi) = \frac{\partial}{\partial \phi} \left( 1 \cdot r \cdot \frac{1}{r \sin\theta} \frac{\partial f}{\partial \phi} \right) = \frac{\partial}{\partial \phi} \left( \frac{1}{\sin\theta} \frac{\partial f}{\partial \phi} \right)
\]
由于 \sin\theta 与 \phi 无关，可提出：
\[
= \frac{1}{\sin\theta} \frac{\partial^2 f}{\partial \phi^2}
\tag{8}
\]

---

### 第六步：将三项代入散度公式

由 (3)、(5)、(6)、(7)、(8)：

\[
\nabla^2 f = \frac{1}{r^2 \sin\theta} \left[
\sin\theta \frac{\partial}{\partial r} \left( r^2 \frac{\partial f}{\partial r} \right)
+ \frac{\partial}{\partial \theta} \left( \sin\theta \frac{\partial f}{\partial \theta} \right)
+ \frac{1}{\sin\theta} \frac{\partial^2 f}{\partial \phi^2}
\right]
\]

现在逐项除以 r^2 \sin\theta：

- 第一项：\frac{1}{r^2 \sin\theta} \cdot \sin\theta \frac{\partial}{\partial r} (r^2 f_r) = \frac{1}{r^2} \frac{\partial}{\partial r} \left( r^2 \frac{\partial f}{\partial r} \right)
- 第二项：\frac{1}{r^2 \sin\theta} \cdot \frac{\partial}{\partial \theta} (\sin\theta f_\theta) = \frac{1}{r^2 \sin\theta} \frac{\partial}{\partial \theta} \left( \sin\theta \frac{\partial f}{\partial \theta} \right)
- 第三项：\frac{1}{r^2 \sin\theta} \cdot \frac{1}{\sin\theta} \frac{\partial^2 f}{\partial \phi^2} = \frac{1}{r^2 \sin^2\theta} \frac{\partial^2 f}{\partial \phi^2}

因此，最终结果为：

\[
\boxed{
\nabla^2 f = 
\frac{1}{r^2} \frac{\partial}{\partial r} \left( r^2 \frac{\partial f}{\partial r} \right)
+ \frac{1}{r^2 \sin\theta} \frac{\partial}{\partial \theta} \left( \sin\theta \frac{\partial f}{\partial \theta} \right)
+ \frac{1}{r^2 \sin^2\theta} \frac{\partial^2 f}{\partial \phi^2}
}
\]

---

### 第七步（可选）：展开成不含括号的形式

若需要展开第一项和第二项：

- 第一项展开：
\[
\frac{1}{r^2} \frac{\partial}{\partial r} \left( r^2 \frac{\partial f}{\partial r} \right) = \frac{1}{r^2} \left( 2r \frac{\partial f}{\partial r} + r^2 \frac{\partial^2 f}{\partial r^2} \right) = \frac{\partial^2 f}{\partial r^2} + \frac{2}{r} \frac{\partial f}{\partial r}
\]

- 第二项展开：
\[
\frac{1}{r^2 \sin\theta} \frac{\partial}{\partial \theta} \left( \sin\theta \frac{\partial f}{\partial \theta} \right) = \frac{1}{r^2 \sin\theta} \left( \cos\theta \frac{\partial f}{\partial \theta} + \sin\theta \frac{\partial^2 f}{\partial \theta^2} \right) = \frac{1}{r^2} \frac{\partial^2 f}{\partial \theta^2} + \frac{\cot\theta}{r^2} \frac{\partial f}{\partial \theta}
\]

所以展开形式为：

\[
\nabla^2 f = 
\frac{\partial^2 f}{\partial r^2} + \frac{2}{r} \frac{\partial f}{\partial r}
+ \frac{1}{r^2} \frac{\partial^2 f}{\partial \theta^2} + \frac{\cot\theta}{r^2} \frac{\partial f}{\partial \theta}
+ \frac{1}{r^2 \sin^2\theta} \frac{\partial^2 f}{\partial \phi^2}
\]
